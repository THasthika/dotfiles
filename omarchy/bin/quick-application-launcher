#!/bin/bash

# Quick application launcher with keyboard shortcuts

# Define applications: Key, Name, Command
declare -A APPS
APPS=(
    ["b"]="Brave:brave"
    ["c"]="Code:code"
    ["f"]="Firefox:firefox"
    ["s"]="Spotify:spotify"
)

# Build the hint message
build_hint() {
    local hint="Quick Launch: "
    local sorted_keys=($(echo "${!APPS[@]}" | tr ' ' '\n' | sort))
    
    for key in "${sorted_keys[@]}"; do
        local name="${APPS[$key]%%:*}"
        hint+="[${key^^}] $name  "
    done
    hint+="[ESC] Cancel"
    echo "$hint"
}

# Show notification with the hint
show_hint() {
    local hint
    hint=$(build_hint)
    
    # Send notification that stays until dismissed
    notify-send -t 0 -u low -a "Quick Launcher" "Quick Application Launcher" "$hint"
}

# Wait for keypress and launch app
wait_for_keypress() {
    # Show hint
    show_hint
    
    # Read a single character
    local key
    read -rsn1 key
    
    # Dismiss the notification
    pkill -SIGUSR2 mako 2>/dev/null || makoctl dismiss --all 2>/dev/null
    
    # Convert to lowercase
    key=$(echo "$key" | tr '[:upper:]' '[:lower:]')
    
    # Check if it's ESC (empty or special char)
    if [[ -z "$key" || "$key" == $'\e' ]]; then
        exit 0
    fi
    
    # Launch the application if key exists
    if [[ -n "${APPS[$key]}" ]]; then
        local cmd="${APPS[$key]##*:}"
        eval "$cmd" &
    fi
}

wait_for_keypress